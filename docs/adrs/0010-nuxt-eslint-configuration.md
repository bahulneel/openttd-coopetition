# ADR-0010: Nuxt ESLint Configuration for Campaign Editor

## Status
Accepted

## Context

The campaign editor workspace needed proper ESLint configuration that integrates with the @nuxt/eslint module while accommodating the specific patterns and requirements of the OpenTTD Campaign Editor project.

### Requirements
- **Nuxt 4 Compatibility**: ESLint must work with Nuxt 4 directory structure and patterns
- **shadcn-vue Support**: Allow single-word component names and Vue composition patterns
- **OpenTTD Patterns**: Support campaign/goal/scenario naming conventions with underscores
- **Development Friendly**: Warnings instead of errors for common development patterns
- **Auto-Generation**: Let @nuxt/eslint module generate base configuration automatically

## Decision

We will use the @nuxt/eslint module to automatically generate ESLint configuration and extend it with project-specific rules rather than manually maintaining a complex ESLint configuration.

### Architecture

#### **1. Automatic Configuration Generation**
```typescript
// nuxt.config.ts
export default defineNuxtConfig({
  modules: [
    '@nuxt/eslint'  // Automatically generates .nuxt/eslint.config.mjs
  ]
})
```

The @nuxt/eslint module:
- **Auto-generates** `.nuxt/eslint.config.mjs` during `nuxt prepare`
- **Detects project structure** (Nuxt 4 app/ directory)
- **Configures proper rules** for Vue, TypeScript, and Nuxt patterns
- **Handles imports and paths** automatically

#### **2. Project-Specific Overrides**
```javascript
// eslint.config.mjs
import withNuxt from './.nuxt/eslint.config.mjs'

export default withNuxt([
  {
    rules: {
      // OpenTTD-specific allowances
      'vue/multi-word-component-names': 'off', // Allow shadcn-vue components (Button, Card, etc.)
      'camelcase': ['error', { 
        allow: ['^openttd_', '^campaign_', '^goal_', '^scenario_'] 
      }],
      '@typescript-eslint/no-unused-vars': ['warn', {
        varsIgnorePattern: '^_|^CardHeader|^difficultyOptions'
      }]
    }
  }
])
```

#### **3. Environment-Specific Rules**
- **Server Code**: Allow console statements, unused error variables
- **Development Files**: More lenient with TypeScript any types
- **Vue Components**: Allow composition patterns and template flexibility

## Implementation

### Phase 1: Module Integration ✅
1. **Add @nuxt/eslint** to devDependencies and modules
2. **Remove manual config** and let module generate automatically
3. **Run nuxt prepare** to generate `.nuxt/eslint.config.mjs`
4. **Create root eslint.config.mjs** that extends generated config

### Phase 2: Project-Specific Rules ✅
1. **OpenTTD Naming**: Allow underscore patterns for game-specific IDs
2. **shadcn-vue Support**: Allow single-word component names
3. **Development Patterns**: Warnings for console, lenient TypeScript rules
4. **Vue Composition**: Support modern Vue patterns and template flexibility

### Phase 3: Environment Configuration ✅
1. **Server Rules**: Allow console statements in API handlers
2. **Type Files**: Disable strict rules for declaration files
3. **Component Patterns**: Support shadcn-vue component structure

## Configuration Details

### **Generated by @nuxt/eslint**
- ✅ **Vue support** with proper component detection
- ✅ **TypeScript integration** with Nuxt 4 paths
- ✅ **Nuxt-specific rules** for pages, layouts, composables
- ✅ **Import resolution** for @/ and ~/ aliases
- ✅ **File discovery** based on Nuxt 4 directory structure

### **Project Overrides**
```javascript
{
  // Core development rules
  'no-console': 'warn',                    // Allow console for debugging
  'vue/multi-word-component-names': 'off', // Allow Button, Card, Input
  'vue/attributes-order': 'off',           // Flexible attribute ordering
  'vue/html-self-closing': 'off',          // Allow <div></div> syntax
  
  // OpenTTD naming conventions
  'camelcase': ['error', { 
    allow: ['^openttd_', '^campaign_', '^goal_', '^scenario_'] 
  }],
  
  // TypeScript flexibility
  '@typescript-eslint/no-unused-vars': ['warn', { /* lenient patterns */ }],
  '@typescript-eslint/no-explicit-any': 'warn'
}
```

### **Benefits of @nuxt/eslint Integration**
- **Automatic Updates**: ESLint config stays current with Nuxt changes
- **Zero Maintenance**: No need to manually maintain complex configuration
- **Best Practices**: Inherits Nuxt team's recommended rules and patterns
- **Framework Integration**: Seamless integration with Nuxt development workflow

## Consequences

### Positive
- **Automatic Configuration**: No need to manually maintain ESLint setup
- **Nuxt 4 Support**: Full compatibility with new directory structure  
- **shadcn-vue Compatibility**: Proper support for copy-paste components
- **Development Friendly**: Warnings instead of blocking errors for common patterns
- **Best Practices**: Inherits Nuxt community standards and recommendations
- **Type Safety**: Full TypeScript integration with proper path resolution

### Negative
- **Additional Dependency**: Adds @nuxt/eslint module dependency
- **Generated Files**: `.nuxt/eslint.config.mjs` is auto-generated and shouldn't be edited
- **Less Control**: Some aspects of configuration are handled automatically

### Risks
- **Module Updates**: Updates to @nuxt/eslint might change behavior
- **Override Conflicts**: Project overrides might conflict with generated rules

### Mitigation Strategies
- **Minimal Overrides**: Only override rules that are absolutely necessary
- **Documentation**: Document all custom rules and their reasoning
- **Testing**: Regularly test linting as part of CI/CD pipeline
- **Version Pinning**: Pin @nuxt/eslint version to avoid unexpected changes

## Integration with Development Workflow

### **Package Scripts**
```json
{
  "scripts": {
    "postinstall": "nuxt prepare",  // Generates ESLint config automatically
    "lint": "eslint .",            // Uses generated + custom config
    "lint:fix": "eslint . --fix"   // Auto-fixes compatible issues
  }
}
```

### **CI/CD Integration**
```yaml
# GitHub Actions workflow
- name: Lint workspace files
  run: npm run lint --workspace=@coopetition/campaign-editor
```

### **IDE Integration**
- **Auto-completion**: ESLint rules visible in VS Code
- **Real-time feedback**: Immediate linting feedback during development  
- **Fix on save**: Automatic fixing of compatible issues

## OpenTTD-Specific Considerations

### **Naming Conventions**
```javascript
// Allowed patterns for OpenTTD game elements
'camelcase': ['error', { 
  allow: [
    '^openttd_',     // OpenTTD internal variables
    '^OPENTTD_',     // OpenTTD constants
    '^campaign_',    // Campaign identifiers
    '^goal_',        // Goal identifiers  
    '^scenario_'     // Scenario identifiers
  ] 
}]
```

### **Component Patterns**
```javascript
// Support shadcn-vue component naming
'vue/multi-word-component-names': 'off'  // Allow Button, Card, Input, etc.
```

### **Development Patterns**
```javascript
// Allow common development patterns
'no-console': 'warn',                     // Debug logging
'@typescript-eslint/no-explicit-any': 'warn'  // Temporary any types
```

## Testing Strategy

### **Lint Integration**
- **Pre-commit hooks**: Run linting before commits
- **CI/CD validation**: Ensure linting passes in build pipeline
- **Developer feedback**: Immediate feedback during development

### **Rule Validation**
- **Periodic review**: Regular review of custom rules
- **Team consistency**: Ensure rules support team development patterns
- **Performance impact**: Monitor ESLint performance on large codebases

## Future Considerations

### **When Nuxt 4 is Released**
- **Configuration Updates**: @nuxt/eslint will automatically update for Nuxt 4
- **Rule Updates**: May need to review custom overrides
- **Best Practices**: Adopt new Nuxt 4 linting best practices

### **ESLint Updates**
- **Flat Config**: Already using ESLint 9 flat config format
- **New Rules**: Evaluate new ESLint rules for adoption
- **Performance**: Monitor ESLint performance improvements

## References

- [Nuxt ESLint Module Documentation](https://eslint.nuxt.com/packages/module)
- [ESLint Flat Config](https://eslint.org/docs/latest/use/configure/configuration-files-new)
- [Vue ESLint Plugin](https://eslint.vuejs.org/)
- [TypeScript ESLint](https://typescript-eslint.io/)
- [ADR-0009: Nuxt4 Tailwind4 shadcn-vue Migration](./0009-nuxt4-tailwind4-shadcn-vue-migration.md)